webpackJsonp([48],{"3NPH":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectDoesNotRemindModal=t.ProjectDoesNotRemindWrapper=t.HeartWatching=t.HeartWrapper=t.WatchingButton=t.WatchingButtonWrapper=t.WatchingModal=t.WatchingModalWrapper=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n("GiK3")),r=n("b04z"),o=n("aq1o"),c=n("ci1u"),u=n("2TQX"),d=n("Z5jf"),i=n("wWf7");t.WatchingModalWrapper=function(e){var t=e.state,n=e.dispatch,r=t.loggedOut?i.exitConfirmModal:i.closeAndDontShowModal;return t.modalOpen?a.default.createElement(l,{onClose:function(){return n((0,i.exitConfirmModal)())},onClick:function(){return n(r())},loggedOut:t.loggedOut}):null};var l=t.WatchingModal=function(e){var t=e.onClose,n=e.onClick,r=e.loggedOut;return a.default.createElement(o.OverlayModal,{headerCopy:(0,d.boundT)("project_page.back_and_star.project_saved"),secondaryCloseCopy:(0,d.boundT)("project_page.back_and_star.Close"),onClose:t,size:"small"},a.default.createElement("div",{id:"focus-grabber"}),a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.well_send_you_an_email"}),!r&&a.default.createElement(a.default.Fragment,null," ",a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.well_also_use",yourRecommendationsLink:a.default.createElement("a",{href:(0,u.url)("/recommendations")},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.your_recommendations"})),userSettingLink:a.default.createElement("a",{href:(0,u.url)("/settings")},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.user_settings"}))}),a.default.createElement("br",null),a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.To_view_and_manage_projects",savedProjectsLink:a.default.createElement("a",{href:(0,u.url)("/profile/starred"),className:"keyboard-focusable"},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.saved_projects"}))})),a.default.createElement(o.PrimaryModalButton,{color:"green",onClick:n},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.ok_got_it"})))},s=(t.WatchingButtonWrapper=function(e){var t=e.state,n=e.dispatch;return a.default.createElement("div",null,a.default.createElement(s,{state:t,onClick:function(){return n((0,i.updateWatch)())}}))},t.WatchingButton=function(e){var t=e.state,n=e.onClick,o=void 0;return null!=t.isWatching||t.loggedOut?t.isWatching?o=(0,d.boundT)("project_page.back_and_star.Saved"):t.projectIsLaunched?t.projectIsLaunched&&t.projectCanRemind?o=(0,d.boundT)("project_page.back_and_star.Remind_me"):t.projectIsLaunched&&!t.projectCanRemind&&(o=(0,d.boundT)("project_page.back_and_star.Save")):o=(0,d.boundT)("project_page.back_and_star.Notify_me_on_launch"):o=a.default.createElement(c.Icon,{name:"icon--circle-loader",atoms:["ml1"]}),a.default.createElement(r.Button,{size:"medium",shadow:"true",atoms:"w100p",color:"white",onClick:n},a.default.createElement(c.Icon,{name:"icon--heart",size:"medium",atoms:["mr1 relative t-1_6"].concat(t.isWatching?["red"]:[])}),a.default.createElement("span",{className:"text-nowrap"},o))}),p=(t.HeartWrapper=function(e){var t=e.state,n=e.dispatch,r=void 0;return t.isWatching?r=(0,d.boundT)("project_page.back_and_star.Saved"):t.projectIsLaunched&&t.projectCanRemind?r=(0,d.boundT)("project_page.back_and_star.Remind_me"):t.projectIsLaunched&&!t.projectCanRemind&&(r=(0,d.boundT)("project_page.back_and_star.Save")),a.default.createElement("button",{onClick:function(){return n((0,i.updateWatch)())},className:"f5 navy-light medium"},a.default.createElement(p,{state:t}),a.default.createElement("span",null,r))},t.HeartWatching=function(e){var t=e.state,n=["mr1 relative t-1_6 r-1_3"].concat(t.isWatching?["fill-red-500"]:[]);return a.default.createElement(c.Icon,{name:"heart",size:"small",atoms:n})}),f=(t.ProjectDoesNotRemindWrapper=function(e){var t=e.state,n=e.dispatch;return!!t.logInModalOpen&&a.default.createElement(f,{onClose:function(){return n((0,i.exitLogInModal)())}})},t.ProjectDoesNotRemindModal=function(e){var t=e.onClose;return a.default.createElement(o.OverlayModal,{headerCopy:(0,d.boundT)("project_page.back_and_star.Save"),secondaryCloseCopy:(0,d.boundT)("project_page.back_and_star.Close"),onClose:t,size:"small"},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.Log_in_to_your_kickstarter_account",LogIn:a.default.createElement("a",{href:(0,u.url)("/login")},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.Log_in"}))}),a.default.createElement("br",null),a.default.createElement("br",null),a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.Dont_have_one_yet",SignUp:a.default.createElement("a",{href:(0,u.url)("/signup")},a.default.createElement(d.BoundTranslate,{i18nKey:"project_page.back_and_star.Sign_up"}))}))})},BDs8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateUserSettingSuccess=t.submitWatchRequest=t.handleUpdateUserSetting=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=n("4RZc"),o=n("tryQ"),c=n("EIRz"),u=n("ZJZe"),d=n("gRjH"),i=n("uCi4"),l=n("wWf7"),s=function(e){return e.forEach(function(e){return o.Honeybadger.notify(e)}),(0,l.noopAction)()};t.default=function(e,t){switch(t.type){case"INITIATE_WATCHING_UPDATE":var n=t.project,r=n.isWatched,o=n.isLaunched,u=n.isWatchable,d=n.id,i=n.trackingData;return(0,c.loop)(a({},e,{trackingData:i,isWatching:r,projectIsLaunched:o,projectCanRemind:u,projectId:d}),c.Cmd.action((0,l.updateWatch)()));case"WATCHING_UPDATE":return e.loggedOut&&!e.isWatching?a({},e,{logInModalOpen:!0}):p(e);case"WATCHING_UPDATE_SUCCESS":return a({},e,{isWatching:t.isWatching,modalOpen:e.canSeeModal&&t.isWatching&&e.projectCanRemind,userFormOpen:!1});case"CONFIRM_MODAL":return f(e);case"EXIT_CONFIRM_MODAL":return a({},e,{modalOpen:!1});case"EXIT_LOGIN_MODAL":return a({},e,{logInModalOpen:!1});case"REQUEST_ERROR":return c.Cmd.run(s,{args:[t.error]});default:return e}};var p=function(e){return(0,c.loop)(e,c.Cmd.run(_,{args:[e],successActionCreator:m(e),failActionCreator:s}))},f=t.handleUpdateUserSetting=function(e){return(0,c.loop)(a({},e,{modalOpen:!1,canSeeModal:!1}),c.Cmd.run(i.updateUserSetting,{args:[e.userId],successActionCreator:g,failActionCreator:s}))},_=t.submitWatchRequest=function(e){return(e.isWatching?d.unwatchProject:u.watchProject)(e.projectId,e.projectShareToken)},m=function(e){return function(t){var n=e.isWatching?"unwatchProject":"watchProject";if(t.errors)return Promise.reject(t.errors);var o=t.data[n].project.isWatched,c=t.data[n].project.pid;return function(e,t,n,o){e?(0,r.track)("Project Star",a({project_pid:t,user_uid:n,type:o.tracking_type,context:o.tracking_context},o.trackingData)):(0,r.track)("Project Unstar",a({project_pid:t,user_uid:n,type:o.tracking_type,context:o.tracking_context},o.trackingData))}(o,c,t.data[n].user.uid,e),(0,l.mutationSucceeded)(o,c)}},g=t.updateUserSettingSuccess=function(e){return e.errors?Promise.reject(e.errors):(0,l.noopAction)()}},BqfC:function(e,t,n){"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=p(n("GiK3")),o=p(n("O27J")),c=n("LbfT"),u=n("fMw8"),d=n("I2cB"),i=n("3NPH"),l=p(n("BDs8")),s=p(n("moQo"));function p(e){return e&&e.__esModule?e:{default:e}}function f(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _=document.getElementsByClassName("watch-project-button"),m=document.getElementsByClassName("watch-project-heart"),g=document.getElementById("watch-project-modal"),h=document.getElementById("project-cant-remind-modal"),j=document.getElementById("watch-project-user-form"),y=d.maybe.fromNullable(g).chain(function(e){return JSON.parse(e.dataset.watch_project)}),b=document.getElementById("react-project-header");if(g&&j&&h&&!b){var E=a({},s.default,{isWatching:y.user_is_watching,projectIsLaunched:y.project_is_launched,projectCanRemind:y.project_can_remind,projectId:y.project_id,userId:y.user_id,canSeeModal:y.show_modal,modalOpen:!1,userFormOpen:!1,logInModalOpen:!1,loggedOut:null==y.user_is_watching,url:y.watch_url,tracking_type:"project_page",tracking_context:"project_page",projectShareToken:(0,u.getUrlParam)(window.location.href).token}),I=(0,c.createEnhancedStore)(l.default,E),C=function(){var e=I.getState(),t=I.dispatch;[].concat(f(_)).forEach(function(n){o.default.render(r.default.createElement(i.WatchingButtonWrapper,{state:e,dispatch:t}),n)}),[].concat(f(m)).forEach(function(n){o.default.render(r.default.createElement(i.HeartWrapper,{state:e,dispatch:t}),n)}),o.default.render(r.default.createElement(i.WatchingModalWrapper,{state:e,dispatch:t}),g),o.default.render(r.default.createElement(i.ProjectDoesNotRemindWrapper,{state:e,dispatch:t}),h)};C(),I.subscribe(C)}},ZJZe:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchProject=void 0;var a=n("OgtI");t.watchProject=function(e,t){var n=t?{share_token:t}:null;return(0,a.fetchGraph)("\n  mutation($projectId: ID!) {\n    watchProject(input:{id: $projectId}) {\n      project {\n        isWatched\n        pid\n      },\n      user {\n        uid\n      }\n    }\n  }\n",{projectId:e},n)}},gRjH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unwatchProject=void 0;var a=n("OgtI");t.unwatchProject=function(e,t){var n=t?{share_token:t}:null;return(0,a.fetchGraph)("\n  mutation($projectId: ID!) {\n    unwatchProject(input:{id: $projectId}) {\n      project {\n        isWatched\n        pid\n      },\n      user {\n        uid\n      }\n    }\n  }\n",{projectId:e},n)}},moQo:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={isWatching:!1,projectIsLaunched:!1,projectCanRemind:!1,projectId:"",modalOpen:!1,canSeeModal:!1,userFormOpen:!1,email:null,fields:["email"],touched:{},errors:{},loggedOut:!1,logInModalOpen:!1,userId:"",url:"",tracking_type:"",tracking_context:"",projectShareToken:""}},tryQ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Honeybadger=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n("tskP")),r=n("pS1G");if(window.honeybadgerConfiguration){var o=window.honeybadgerConfiguration;/(kickstarter\.com|d\.rip)$/.test(window.location.hostname)||(o.disabled=!0),a.default.configure(o)}"function"==typeof a.default.setContext&&a.default.setContext((0,r.buildHoneybadgerContext)()),"function"==typeof a.default.beforeNotify&&a.default.beforeNotify(function(e){if(/(ksr|drip)\.test/.test(window.location.hostname))return console.error("Honeybadger in development",e),!1}),t.Honeybadger=a.default},uCi4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateUserSetting=void 0;var a=n("OgtI");t.updateUserSetting=function(e){return(0,a.fetchGraph)("\n  mutation($userId: ID!) {\n    updateUserSetting(input:{id: $userId}) {\n      userConfirmedNotice\n    }\n  }\n",{userId:e})}},wWf7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.initiateWatchingUpdate=function(e){return{type:"INITIATE_WATCHING_UPDATE",project:e}},t.updateWatch=function(){return{type:"WATCHING_UPDATE"}},t.mutationSucceeded=function(e,t){return{type:"WATCHING_UPDATE_SUCCESS",isWatching:e,pid:t}},t.closeAndDontShowModal=function(){return{type:"CONFIRM_MODAL"}},t.exitConfirmModal=function(){return{type:"EXIT_CONFIRM_MODAL"}},t.requestError=function(e){return{type:"REQUEST_ERROR",error:e}},t.exitLogInModal=function(){return{type:"EXIT_LOGIN_MODAL"}},t.noopAction=function(){return{type:"NOOP"}},t.noopConfirm=function(){return{type:"NOOP_CONFIRM_BUTTON"}}}},["BqfC"]);
//# sourceMappingURL=watching.1a7b3cb1b8e9b62b2ef0.js.map