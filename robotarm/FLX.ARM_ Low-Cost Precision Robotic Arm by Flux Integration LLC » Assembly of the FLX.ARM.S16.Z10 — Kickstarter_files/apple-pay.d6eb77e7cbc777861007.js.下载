webpackJsonp([49],{2:function(e,t,a){e.exports=a("AgKi")},"9VV1":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(a("l/Rs")),o=a("Tvaj");a("s94J");var r,i=(0,n.default)("#growl_section");function l(){i.fadeOut("fast"),r&&r.length&&r.focus()}i.on("click",function(e){var t;(0,n.default)(e.target).is((0,n.default)(this))&&((t=(0,n.default)(this)).fadeOut("fast"),t.removeClass("sticky"),t.find("div.jGrowl-notification:parent").each(function(){(0,n.default)(this).data("jGrowl")&&((0,n.default)(this).data("jGrowl").sticky=!1)}))}),(0,n.default)(document).on("keydown",function(e){e.which===o.ESC&&i.is(":visible")&&l()});var c=function(e,t){n.default.each(e,function(e,a){void 0===t&&(t={}),"error"===e&&(t.sticky=!0,i.addClass("sticky")),i.jGrowl(a,n.default.extend(t,{theme:e,closeTemplate:'<button class="jGrowl-close-x" aria-label="close notification"><span class="ksr-icon__close" aria-hidden="true"></span></button>',beforeOpen:function(){i.fadeIn("fast"),r=(0,n.default)(":focus"),i.find(".jGrowl-notification").attr("tabindex",-1).focus()},close:function(){l()}}))})};window.growl=c,t.default=c},AgKi:function(e,t,a){"use strict";var n=u(a("l/Rs")),o=a("jRaX"),r=u(a("dER8")),i=u(a("JaGq")),l=u(a("c5nH")),c=u(a("eF8u")),s=a("twwy"),d=a("I2cB");function u(e){return e&&e.__esModule?e:{default:e}}var p=void 0,f=function(){},h=function(e,t){return function(a){return a?e():t()}},m=function(){var e=document.getElementsByClassName("js-applepay-button");e.length>0&&((0,s.trackApplePayShowButtons)(),document.body.classList.remove("not-apple-pay-capable"),document.body.classList.add("apple-pay-capable"),Array.prototype.forEach.call(e,function(e){e.addEventListener("click",w,!1)}),document.querySelectorAll("[name=apple_pay_capable]").forEach(function(e){return e.value=1}))},w=function(e){e.preventDefault();var t=void 0;try{t=(0,i.default)(this,document.querySelector('meta[name="csrf-token"]').getAttribute("content"))}catch(e){if("string"==typeof r.default[e])return!1;throw r.default.paymentSetupFailed(e),e}var a=t.applePayRequest,n=t.checkout;return(p=Stripe.applePay.buildSession(a,y(n),function(e){return r.default.paymentErroredByVendor(e)})).oncancel=s.trackApplePayCancelled,(0,s.trackApplePayShowSheet)(),p.begin(),!1},y=function(e){return function(t,a){(0,s.trackApplePayTokenCreated)();var n=l.default.get("urls").web.project+"/pledge";g(n,e).then(function(e){var n=_(a,t.token.id,e);n.done(function(e){return v(a,e.data.thankyou_url)}),n.error(function(e){return r.default.paymentErroredByKickstarter(a,e)})}).catch(function(e){r.default.paymentErroredByKickstarter(a,e)})}},g=function(e,t){if(t.id>0){var a=document.querySelector("#js-stripe_form").getAttribute("action"),n=d.maybe.fromNullable(document.querySelector("#react-payments-form")).chain(function(e){return d.maybe.fromNullable(e.dataset.checkoutUrl)}).getOrElse(a);return new Promise(function(e){e({data:{checkout_url:n}})})}return fetch(e,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-Token":(0,o.csrfToken)(document)},body:JSON.stringify(t)}).then(function(e){return e.json()})},_=function(e,t,a){return n.default.ajax({url:a.data.checkout_url,method:"POST",data:{token:t,payment_type:"apple_pay",apple_pay_capable:"1"},dataType:"json"})},v=function(e,t){e(ApplePaySession.STATUS_SUCCESS),window.location.pathname=""+t.replace(/\?.*$/,"")};(0,n.default)(function(e,t){return function(){"undefined"!=typeof Stripe&&"undefined"!=typeof ApplePaySession&&void 0!==window.STRIPE_PUBLISHABLE_KEY&&void 0!==c.default&&void 0!==l.default&&void 0!==window.apple_pay_countries&&"live"===l.default.get("state")&&!/\/retry$/.test(window.location.pathname)&&"pledges_edit"!==document.body.id&&window.apple_pay_countries.indexOf(l.default.get("country"))>=0?e():t()}}(function(){Stripe.setPublishableKey(window.STRIPE_PUBLISHABLE_KEY),Stripe.applePay.checkAvailability(h(m,f))},f))},JaGq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var a={checkout:{authenticity_token:t},applePayRequest:{countryCode:o.default.get("country"),currencyCode:o.default.get("currency"),lineItems:[],total:{label:"Kickstarter, PBC. ("+i.default.t("onloads.views.applepay.if_funded")+")"}}};return e.dataset.checkout_id?d(e,a):s(e,a)};var n=l(a("dER8")),o=l(a("c5nH")),r=l(a("L3hI")),i=l(a("wmCY"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t){var a=function(e){var t=e.replace(o.default.get("currency_symbol"),"").replace(" ","").replace(i.default.t("number.currency.format.delimiter"),"").replace(i.default.t("number.currency.format.separator"),".");return parseFloat(t)}(t);if(a<e.minimum){var l=i.default.t("onloads.mobile.pledge.new.Please_enter_a_pledge_amount_of_at_least_amount_to_select",{amount:r.default.money(e.minimum,{currency:o.default.get("currency"),precision:0})});n.default.rewardError(n.default.MINIMUM_AMOUNT,l)}return a},s=function(e,t){var a=e.closest("form"),l=a.querySelector('input[name="backing[amount]"]').value,s=e.closest(".js-reward-available"),d=a.querySelector("select#backing_location_id"),u=function(e,t){if(void 0!==e.dataset.rewardId){var a=parseInt(e.dataset.rewardId,10),n=t.get("rewards").find(function(e){return e.id===a}),o=window.rewards.find(function(e){return e.id===a});return void 0!==o&&(n.shipping_rules=o.shipping_rules),n}if(void 0!==e.dataset.reward)return JSON.parse(e.dataset.reward)}(s,o.default),p=c(u,l);return t.checkout.backing={amount:l,backer_reward_id:u.id},(t=function(e,t,a,l){if(null!==l){var c=parseInt(l.value,10);""!==c&&"0"!==c||n.default.shippingNotSelectedError(),e.checkout.backing.location_id=c;var s=t.shipping_rules.find(function(e){return e.location_id===c});if(void 0===s){var d=i.default.t("onloads.mobile.pledge.new.Please_select_your_shipping_location_to_select");n.default.rewardError(n.default.SHIPPING_RULE_NOT_FOUND,d)}var u=t.minimum+parseFloat(s.cost);if(a<u){var p=i.default.t("onloads.mobile.pledge.new.Please_enter_a_pledge_amount_of_at_least_to_ship",{amount:r.default.money(u,{currency:o.default.get("currency"),precision:0})});n.default.rewardError(n.default.MINIMUM_AMOUNT_SHIPPING_INCLUDED,p)}}return e}(t,u,p,d)).applePayRequest.lineItems=[{label:""+(u.title||o.default.get("name")),amount:p.toString()}],t.applePayRequest.total.amount=p.toString(),t},d=function(e,t){return t.checkout={id:parseInt(e.dataset.checkout_id,10),amount:e.dataset.checkout_amount},t.applePayRequest.lineItems=[{label:""+(e.dataset.checkout_reward_title||o.default.get("name")),amount:e.dataset.checkout_amount.toString()}],t.applePayRequest.total.amount=e.dataset.checkout_amount.toString(),t}},dER8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(a("9VV1")),o=a("tryQ"),r=c(a("wmCY")),i=a("twwy"),l=a("orEx");function c(e){return e&&e.__esModule?e:{default:e}}t.default={MINIMUM_AMOUNT:"MINIMUM_AMOUNT",MINIMUM_AMOUNT_SHIPPING_INCLUDED:"MINIMUM_AMOUNT_SHIPPING_INCLUDED",SHIPPING_NOT_SELECTED:"SHIPPING_NOT_SELECTED",SHIPPING_RULE_NOT_FOUND:"SHIPPING_RULE_NOT_FOUND",rewardError:function(e,t){throw(0,n.default)({error:t}),(0,i.trackApplePayErroredReward)({type:this[e]}),this.MINIMUM_AMOUNT},paymentErroredByKickstarter:function(e,t){var a=(0,l.parseResponseForMessage)(t,r.default.t("onloads.views.applepay.errors.oops_something"));(0,i.trackApplePayErroredKSR)({type:a}),e(ApplePaySession.STATUS_FAILURE),t.responseJSON.data.redirect_url?window.location=t.responseJSON.data.redirect_url:(0,n.default)({error:a})},paymentErroredByVendor:function(e){(0,i.trackApplePayErroredStripe)({type:e.message}),"api_error"!==e.type&&o.Honeybadger.notify(JSON.stringify(e))},paymentSetupFailed:function(e){o.Honeybadger.notify(e),(0,n.default)({error:r.default.t("onloads.views.applepay.errors.oops_something")})},shippingNotSelectedError:function(){throw(0,i.trackApplePayErroredShippingSelection)(),(0,n.default)({error:r.default.t("onloads.views.applepay.errors.oops_shipping")}),this.SHIPPING_NOT_SELECTED}}},orEx:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getContextFromPathName=function(e){return/^\/projects\/.+pledge\/new$/.test(e)?"Reward Selection":/^\/checkouts\/.+payments\/new$/.test(e)?"Payments Page":/^\/projects\/[^\/pledge|\/payments]/.test(e)?"Project Page":null},t.parseResponseForMessage=function(e,t){try{var a=e.responseJSON.data.errors,n=[];for(var o in a)n.push(a[o][0]);return n[0]}catch(e){return t}}},s94J:function(e,t,a){var n=a("l/Rs");a("l/Rs");!function(e){e.jGrowl=function(t,a){0===e("#jGrowl").length&&e('<div id="jGrowl"></div>').addClass(a&&a.position?a.position:e.jGrowl.defaults.position).appendTo(a&&a.appendTo?a.appendTo:e.jGrowl.defaults.appendTo),e("#jGrowl").jGrowl(t,a)},e.fn.jGrowl=function(t,a){if(void 0===a&&e.isPlainObject(t)&&(t=(a=t).message),e.isFunction(this.each)){var n=arguments;return this.each(function(){void 0===e(this).data("jGrowl.instance")&&(e(this).data("jGrowl.instance",e.extend(new e.fn.jGrowl,{notifications:[],element:null,interval:null})),e(this).data("jGrowl.instance").startup(this)),e.isFunction(e(this).data("jGrowl.instance")[t])?e(this).data("jGrowl.instance")[t].apply(e(this).data("jGrowl.instance"),e.makeArray(n).slice(1)):e(this).data("jGrowl.instance").create(t,a)})}},e.extend(e.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:!1,position:"top-right",appendTo:"body",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3e3,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:!0,closeTemplate:"&times;",closerTemplate:"<div>[ close all ]</div>",log:function(){},beforeOpen:function(){},afterOpen:function(){},open:function(){},beforeClose:function(){},close:function(){},click:function(){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(t,a){var n=e.extend({},this.defaults,a);void 0!==n.speed&&(n.openDuration=n.speed,n.closeDuration=n.speed),this.notifications.push({message:t,options:n}),n.log.apply(this.element,[this.element,t,n])},render:function(t){var a=this,n=t.message,o=t.options;o.themeState=""===o.themeState?"":"ui-state-"+o.themeState;var r=e("<div/>").addClass("jGrowl-notification alert "+o.themeState+" ui-corner-all"+(void 0!==o.group&&""!==o.group?" "+o.group:"")).append(e("<button/>").addClass("jGrowl-close").html(o.closeTemplate)).append(e("<div/>").addClass("jGrowl-header").html(o.header)).append(e("<div/>").addClass("jGrowl-message").html(n)).data("jGrowl",o).addClass(o.theme).children(".jGrowl-close").bind("click.jGrowl",function(){return e(this).parent().trigger("jGrowl.beforeClose"),!1}).parent();e(r).bind("mouseover.jGrowl",function(){e(".jGrowl-notification",a.element).data("jGrowl.pause",!0)}).bind("mouseout.jGrowl",function(){e(".jGrowl-notification",a.element).data("jGrowl.pause",!1)}).bind("jGrowl.beforeOpen",function(){!1!==o.beforeOpen.apply(r,[r,n,o,a.element])&&e(this).trigger("jGrowl.open")}).bind("jGrowl.open",function(){!1!==o.open.apply(r,[r,n,o,a.element])&&("after"==o.glue?e(".jGrowl-notification:last",a.element).after(r):e(".jGrowl-notification:first",a.element).before(r),e(this).animate(o.animateOpen,o.openDuration,o.easing,function(){!1===e.support.opacity&&this.style.removeAttribute("filter"),null!==e(this).data("jGrowl")&&void 0!==e(this).data("jGrowl")&&(e(this).data("jGrowl").created=new Date),e(this).trigger("jGrowl.afterOpen")}))}).bind("jGrowl.afterOpen",function(){o.afterOpen.apply(r,[r,n,o,a.element])}).bind("click",function(){o.click.apply(r,[r,n,o,a.element])}).bind("jGrowl.beforeClose",function(){!1!==o.beforeClose.apply(r,[r,n,o,a.element])&&e(this).trigger("jGrowl.close")}).bind("jGrowl.close",function(){e(this).data("jGrowl.pause",!0),e(this).animate(o.animateClose,o.closeDuration,o.easing,function(){e.isFunction(o.close)?!1!==o.close.apply(r,[r,n,o,a.element])&&e(this).remove():e(this).remove()})}).trigger("jGrowl.beforeOpen"),""!==o.corners&&void 0!==e.fn.corner&&e(r).corner(o.corners),e(".jGrowl-notification:parent",a.element).length>1&&0===e(".jGrowl-closer",a.element).length&&!1!==this.defaults.closer&&e(this.defaults.closerTemplate).addClass("jGrowl-closer "+this.defaults.themeState+" ui-corner-all").addClass(this.defaults.theme).appendTo(a.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){e(this).siblings().trigger("jGrowl.beforeClose"),e.isFunction(a.defaults.closer)&&a.defaults.closer.apply(e(this).parent()[0],[e(this).parent()[0]])})},update:function(){e(this.element).find(".jGrowl-notification:parent").each(function(){void 0!==e(this).data("jGrowl")&&void 0!==e(this).data("jGrowl").created&&e(this).data("jGrowl").created.getTime()+parseInt(e(this).data("jGrowl").life,10)<(new Date).getTime()&&!0!==e(this).data("jGrowl").sticky&&(void 0===e(this).data("jGrowl.pause")||!0!==e(this).data("jGrowl.pause"))&&e(this).trigger("jGrowl.beforeClose")}),this.notifications.length>0&&(0===this.defaults.pool||e(this.element).find(".jGrowl-notification:parent").length<this.defaults.pool)&&this.render(this.notifications.shift()),e(this.element).find(".jGrowl-notification:parent").length<2&&e(this.element).find(".jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){e(this).remove()})},startup:function(t){this.element=e(t).addClass("jGrowl").append('<div class="jGrowl-notification"></div>'),this.interval=setInterval(function(){var a=e(t).data("jGrowl.instance");void 0!==a&&a.update()},parseInt(this.defaults.check,10))},shutdown:function(){e(this.element).removeClass("jGrowl").find(".jGrowl-notification").trigger("jGrowl.close").parent().empty(),clearInterval(this.interval)},close:function(){e(this.element).find(".jGrowl-notification").each(function(){e(this).trigger("jGrowl.beforeClose")})}}),e.jGrowl.defaults=e.fn.jGrowl.prototype.defaults}(n)},tryQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Honeybadger=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(a("tskP")),o=a("pS1G");if(window.honeybadgerConfiguration){var r=window.honeybadgerConfiguration;/(kickstarter\.com|d\.rip)$/.test(window.location.hostname)||(r.disabled=!0),n.default.configure(r)}"function"==typeof n.default.setContext&&n.default.setContext((0,o.buildHoneybadgerContext)()),"function"==typeof n.default.beforeNotify&&n.default.beforeNotify(function(e){if(/(ksr|drip)\.test/.test(window.location.hostname))return console.error("Honeybadger in development",e),!1}),t.Honeybadger=n.default},twwy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackApplePayTokenCreated=t.trackApplePayShowSheet=t.trackApplePayShowButtons=t.trackApplePayErroredStripe=t.trackApplePayErroredShippingSelection=t.trackApplePayErroredReward=t.trackApplePayErroredKSR=t.trackApplePayCancelled=void 0;var n=a("orEx"),o=a("4RZc");t.trackApplePayCancelled=function(){(0,o.track)("Canceled Apple Pay Sheet",{context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayErroredKSR=function(e){var t=e.type;(0,o.track)("Apple Pay Kickstarter Errored",{type:t,context:(0,n.getContextFromPathName)(window.location.pathname)}),(0,o.track)("Errored Apple Pay Kickstarter",{type:t,context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayErroredReward=function(e){var t=e.type;(0,o.track)("Apple Pay Errored Reward Continue",{type:t,context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayErroredShippingSelection=function(){(0,o.track)("Apple Pay Shipping Selection Errored",{context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayErroredStripe=function(e){var t=e.type;(0,o.track)("Apple Pay Stripe Token Errored",{type:t,context:(0,n.getContextFromPathName)(window.location.pathname)}),(0,o.track)("Errored Apple Pay Stripe Token",{type:t,context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayShowButtons=function(){(0,o.track)("Showed Apple Pay Buttons",{context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayShowSheet=function(){(0,o.track)("Apple Pay Show Sheet",{context:(0,n.getContextFromPathName)(window.location.pathname)}),(0,o.track)("Showed Apple Pay Sheet",{context:(0,n.getContextFromPathName)(window.location.pathname)})},t.trackApplePayTokenCreated=function(){(0,o.track)("Apple Pay Stripe Token Created",{context:(0,n.getContextFromPathName)(window.location.pathname)}),(0,o.track)("Created Apple Pay Stripe Token",{context:(0,n.getContextFromPathName)(window.location.pathname)})}}},[2]);
//# sourceMappingURL=apple-pay.d6eb77e7cbc777861007.js.map